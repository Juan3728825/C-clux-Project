CREATE DATABASE IF NOT EXISTS C_CLUX CHARACTER SET UTF8 COLLATE UTF8_GENERAL_CI;USE C_CLUX;

-- TABLA ADMINISTRADOR --

CREATE TABLE ADMINISTRADOR (
	USUARIO_ID INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(100) NOT NULL,
    APELLIDO VARCHAR (100) NOT NULL,
    CORREO_ELECTRONICO VARCHAR (255) NOT NULL,
    NUMERO_TELEFONO INT (100),
    DIRECCION VARCHAR (255),
    CONTRASENA VARCHAR (255)
);

-- TABLA ASOCIADO --

CREATE TABLE ASOCIADO (
	USUARIO_ID INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(100) NOT NULL,
    APELLIDO VARCHAR (100) NOT NULL,
    CORREO_ELECTRONICO VARCHAR (255) NOT NULL,
    NUMERO_TELEFONO INT (100),
    DIRECCION VARCHAR (255),
    CONTRASENA VARCHAR (255)
);

-- TABLA COMPRADOR --
CREATE TABLE COMPRADOR (
	USUARIO_ID INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(100) NOT NULL,
    APELLIDO VARCHAR (100) NOT NULL,
    CORREO_ELECTRONICO VARCHAR (255) NOT NULL,
    NUMERO_TELEFONO INT (100),
    DIRECCION VARCHAR (255),
    CONTRASENA VARCHAR (255)
);

-- TABLA CITA --
CREATE TABLE CITA (
    CITA_ID INT AUTO_INCREMENT PRIMARY KEY,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    CLIENTE_ID INT,
    ASOCIADO_ID INT,
    FOREIGN KEY (CLIENTE_ID) REFERENCES ADMINISTRADOR(USUARIO_ID),
    FOREIGN KEY (ASOCIADO_ID) REFERENCES ADMINISTRADOR(USUARIO_ID)
);

-- TABLA PRODUCTO --
CREATE TABLE PRODUCTO (
    PRODUCTO_ID INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(255) NOT NULL,
    DESCRIPCION TEXT NOT NULL,
    PRECIO DECIMAL(10, 2) NOT NULL,
    IMAGEN VARCHAR(255) NOT NULL,
    DESTACADO BOOLEAN NOT NULL
);

-- TABLA VENTA --
CREATE TABLE VENTA (
    VENTA_ID INT AUTO_INCREMENT PRIMARY KEY,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    PRODUCTO_ID INT,
    COMPRADOR_ID INT,
    ASOCIADO_ID INT,
    FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(PRODUCTO_ID),
    FOREIGN KEY (COMPRADOR_ID) REFERENCES COMPRADOR(USUARIO_ID),
    FOREIGN KEY (Asociado_ID) REFERENCES ASOCIADO(USUARIO_ID)
);

-- TABLA PAGO --
CREATE TABLE PAGO (
    PAGO_ID INT AUTO_INCREMENT PRIMARY KEY,
    MONTO DECIMAL(10, 2) NOT NULL,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    METODO ENUM('PayPal', 'Tarjeta', 'Deposito') NOT NULL,
    COMPRADOR_ID INT,
    FOREIGN KEY (COMPRADOR_ID) REFERENCES COMPRADOR(USUARIO_ID)
);

-- TABLA CHAT_IA --
CREATE TABLE CHAT_IA (
    MENSAJE_ID INT AUTO_INCREMENT PRIMARY KEY,
    CONTENIDO TEXT NOT NULL,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    USUARIO_ID INT,
    FOREIGN KEY (USUARIO_ID) REFERENCES COMPRADOR(USUARIO_ID)
);

-- TABLA SUSCRIPCION --
CREATE TABLE SUSCRIPCION (
    SUSCRIPCION_ID INT AUTO_INCREMENT PRIMARY KEY,
    COMPRADOR_ID INT,
    BENEFICIOS TEXT NOT NULL,
    ESTADO ENUM('Activa', 'Inactiva') NOT NULL,
    FOREIGN KEY (COMPRADOR_ID) REFERENCES COMPRADOR(Usuario_ID)
);

-- TABLA LISTA_DESTACADOS
CREATE TABLE LISTA_DESTACADOS (
    LISTA_DESTACADOS_ID INT AUTO_INCREMENT PRIMARY KEY,
    ASOCIADO_ID INT,
    PRODUCTO_ID INT,
    FECHA_ACTUALIZACION DATE NOT NULL,
    FOREIGN KEY (ASOCIADO_ID) REFERENCES ASOCIADO(USUARIO_ID),
    FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(PRODUCTO_ID)
);

-- MODIFICACIÓN EN LA TABLA ASOCIADO
ALTER TABLE ASOCIADO ADD COLUMN LISTA_DESTACADOS_ID INT;
ALTER TABLE ASOCIADO ADD FOREIGN KEY (LISTA_DESTACADOS_ID) REFERENCES LISTA_DESTACADOS(LISTA_DESTACADOS_ID);

-- RELACIÓN ENTRE ASOCIADO Y LISTA_DESTACADOS
-- (UN ASOCIADO PUEDE GESTIONAR VARIAS LISTAS DE PRODUCTOS DESTACADOS, PERO CADA LISTA PERTENECE A UN SOLO ASOCIADO)